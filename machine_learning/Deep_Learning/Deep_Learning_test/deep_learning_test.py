from flask import Flask, render_template, request
import pandas as pd
import numpy as np
from keras.models import Sequential
from keras.layers import Dense
from sklearn.preprocessing import LabelEncoder, StandardScaler
from keras.models import load_model

app = Flask(__name__, template_folder="/path/to/dir")

@app.route('/')
def index():
    return render_template('index')

@app.route('/upload', methods=['GET','POST'])
def predict():
    file = request.files["file"]
    data = pd.read_csv(file, sep=',') # The dataset should have atleast '57' columns with newer or unrecognized samples of different attributes and characteristics. 
    x = data.drop(['column'], axis=1).values # Dropping unnecessary columns from the dataset.
    names = data['Name'].values
    new_x = LabelEncoder().fit_transform(x.ravel()).reshape(*x.shape)
    reshaped_x = new_x.reshape((new_x.shape[0], -1))
    norm_x = StandardScaler().fit_transform(reshaped_x)

    model = load_model('trained_weights_of_neural_network') # It is a file that contains the best weights learned by a neural network during the training process.

    predictions = model.predict(norm_x)
    rounded_predictions = np.round(predictions)

    legit_files = []
    malware_files = []
    for i in range(len(rounded_predictions)):
        if rounded_predictions[i] == 0:
            malware_files.append(names[i])
        else:
            legit_files.append(names[i])

    return render_template('predictions', malware_files=malware_files, legit_files=legit_files)

if __name__ == "__main__":
    app.run(debug=True)
